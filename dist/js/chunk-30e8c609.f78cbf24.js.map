{"version":3,"sources":["webpack:///./src/components/ui/AppPage.vue","webpack:///./src/components/ui/AppPage.vue?948e","webpack:///./src/utils/currency.js","webpack:///./node_modules/core-js/modules/es.string.sub.js","webpack:///./node_modules/core-js/internals/create-html.js","webpack:///./node_modules/core-js/internals/string-html-forced.js","webpack:///./src/views/Cart.vue","webpack:///./src/components/user/UserAuthForm.vue","webpack:///./src/components/user/UserAuthForm.vue?c852","webpack:///./src/use/cart-page.js","webpack:///./src/utils/pay.js","webpack:///./src/views/Cart.vue?e0a5","webpack:///./src/use/product-cart.js"],"names":["class","back","to","center","title","props","type","String","required","Boolean","default","setup","document","render","__scopeId","formatter","Intl","NumberFormat","currency","style","value","format","$","createHTML","forcedStringHTMLMethod","target","proto","forced","sub","this","requireObjectCoercible","quot","module","exports","string","tag","attribute","S","p1","replace","fails","METHOD_NAME","test","toLowerCase","split","length","isEmpty","cart","key","add","disabled","count","price","total","isAuth","onPay","for","login","id","email","password","signUp","store","dispatch","useCartPage","useStore","products","computed","getters","find","p","Object","keys","reduce","acc","pay","amount","description","accountId","data","widget","cp","CloudPayments","Promise","resolve","reject","publicId","skin","onSuccess","options","onFail","reason","loading","router","user","push","name","console","log","components","AppPage","UserAuthForm","useProductCart","defaultId","prodId","commit"],"mappings":"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","file":"js/chunk-30e8c609.f78cbf24.js","sourcesContent":["<template>\n  <div class=\"breadcrumbs\" v-if=\"back\">\n    <router-link to=\"/\" class=\"text-white\">Вернуться к товарам</router-link>\n  </div>\n  <div :class=\"['card', {center}]\">\n    <h1 class=\"card-title\">\n      <span v-once>{{title}}</span>\n      <slot name=\"header\" />\n    </h1>\n\n    <slot />\n  </div>\n</template>\n\n<script>\nexport default {\n  props: {\n    title: {\n      type: String,\n      required: true\n    },\n    back: {\n      type: Boolean,\n      default: false\n    },\n    center: {\n      type: Boolean,\n      default: false\n    }\n  },\n  setup(props) {\n    if (props.title) {\n      document.title = `${props.title} | Vue Лавка`\n    }\n  }\n}\n</script>\n\n<style scoped>\n\n</style>","import { render } from \"./AppPage.vue?vue&type=template&id=b841083e&scoped=true\"\nimport script from \"./AppPage.vue?vue&type=script&lang=js\"\nexport * from \"./AppPage.vue?vue&type=script&lang=js\"\nscript.render = render\nscript.__scopeId = \"data-v-b841083e\"\n\nexport default script","const formatter = new Intl.NumberFormat('ru-RU', {currency: 'RUB', style: 'currency'})\n\nexport function currency(value) {\n  return formatter.format(value)\n}","'use strict';\nvar $ = require('../internals/export');\nvar createHTML = require('../internals/create-html');\nvar forcedStringHTMLMethod = require('../internals/string-html-forced');\n\n// `String.prototype.sub` method\n// https://tc39.es/ecma262/#sec-string.prototype.sub\n$({ target: 'String', proto: true, forced: forcedStringHTMLMethod('sub') }, {\n  sub: function sub() {\n    return createHTML(this, 'sub', '', '');\n  }\n});\n","var requireObjectCoercible = require('../internals/require-object-coercible');\n\nvar quot = /\"/g;\n\n// B.2.3.2.1 CreateHTML(string, tag, attribute, value)\n// https://tc39.es/ecma262/#sec-createhtml\nmodule.exports = function (string, tag, attribute, value) {\n  var S = String(requireObjectCoercible(string));\n  var p1 = '<' + tag;\n  if (attribute !== '') p1 += ' ' + attribute + '=\"' + String(value).replace(quot, '&quot;') + '\"';\n  return p1 + '>' + S + '</' + tag + '>';\n};\n","var fails = require('../internals/fails');\n\n// check the existence of a method, lowercase\n// of a tag and escaping quotes in arguments\nmodule.exports = function (METHOD_NAME) {\n  return fails(function () {\n    var test = ''[METHOD_NAME]('\"');\n    return test !== test.toLowerCase() || test.split('\"').length > 3;\n  });\n};\n","<template>\n  <app-page title=\"Корзина\">\n    <h3 class=\"text-center\" v-if=\"isEmpty\">В корзине пока ничего нет</h3>\n    <template v-else>\n      <table class=\"table\">\n        <thead>\n        <tr>\n          <th>Наименование</th>\n          <th>Количество</th>\n          <th>Цена (шт)</th>\n        </tr>\n        </thead>\n        <tbody>\n        <tr v-for=\"(value, key) in cart\" :key=\"key\">\n          <td>{{title(key)}}</td>\n          <td>\n            <button class=\"btn primary\" @click.stop=\"add(key)\" :disabled=\"value >= count(key)\">+</button>\n            {{value}} шт.\n            <button class=\"btn danger\" @click=\"sub(key)\">-</button>\n          </td>\n          <td>{{price(key)}}</td>\n        </tr>\n        </tbody>\n      </table>\n      <hr>\n      <p class=\"text-right\"><strong>Всего: {{currency(total)}}</strong></p>\n      <p class=\"text-right\" v-if=\"isAuth && !isEmpty\">\n        <button class=\"btn\" @click=\"onPay\">Оплатить</button>\n      </p>\n      <UserAuthForm v-else />\n    </template>\n  </app-page>\n</template>\n\n<script>\nimport {onMounted, ref, computed} from 'vue'\nimport {useStore} from 'vuex'\nimport UserAuthForm from '../components/user/UserAuthForm'\nimport AppPage from '../components/ui/AppPage'\nimport {useProductCart} from '../use/product-cart'\nimport {useCartPage} from '../use/cart-page'\nimport {pay} from '../utils/pay'\nimport {currency} from '../utils/currency'\nimport {useRouter} from 'vue-router'\n\nexport default {\n  setup() {\n    const loading = ref(true)\n    const store = useStore()\n    const router = useRouter()\n    const {add, sub} = useProductCart()\n    const {total} = useCartPage()\n\n    onMounted(async () => {\n      await store.dispatch('product/load')\n      loading.value = false\n    })\n\n    const user = computed(() => store.getters['auth/user'])\n    const isAuth = computed(() => store.getters['auth/isAuthenticated'])\n\n    const onPay = async () => {\n      try {\n        await pay({\n          description: 'Покупка товаров в онлайн магазине',\n          amount: total.value,\n          accountId: user.value.email,\n          data: {\n            test: 1\n          }\n        })\n        await store.dispatch('order/create')\n        router.push({name: 'Thanks'})\n      } catch (e) {\n        console.log('Reject pay: ', e)\n      }\n    }\n\n    return {\n      ...useCartPage(),\n      add,\n      sub,\n      isAuth,\n      loading,\n      onPay,\n      currency\n    }\n  },\n  components: {AppPage, UserAuthForm}\n}\n</script>\n\n<style scoped>\n\n</style>","<template>\n  <form @submit.prevent=\"login\">\n    <h3>Войдите в систему или создайте аккаунт для совершения покупки</h3>\n\n    <div class=\"form-control\">\n      <label for=\"email\">Email</label>\n      <input type=\"email\" id=\"email\" v-model=\"email\">\n    </div>\n\n    <div class=\"form-control\">\n      <label for=\"password\">Пароль</label>\n      <input type=\"password\" id=\"password\" v-model=\"password\">\n    </div>\n\n    <button class=\"btn primary\" type=\"submit\">Войти</button>\n    <button class=\"btn\" type=\"button\" @click=\"signUp\">Создать аккаунт</button>\n  </form>\n</template>\n\n<script>\nimport {ref} from 'vue'\nimport {useStore} from 'vuex'\n\nexport default {\n  setup() {\n    const store = useStore()\n    const email = ref('')\n    const password = ref('')\n\n    const login = async () => {\n      await store.dispatch('auth/login', {\n        email: email.value,\n        password: password.value\n      })\n    }\n\n    const signUp = async () => {\n      await store.dispatch('auth/signUp', {\n        email: email.value,\n        password: password.value\n      })\n    }\n\n    return {\n      email,\n      password,\n      login,\n      signUp\n    }\n  }\n}\n</script>\n\n<style scoped>\n\n</style>","import { render } from \"./UserAuthForm.vue?vue&type=template&id=51c86878&scoped=true\"\nimport script from \"./UserAuthForm.vue?vue&type=script&lang=js\"\nexport * from \"./UserAuthForm.vue?vue&type=script&lang=js\"\nscript.render = render\nscript.__scopeId = \"data-v-51c86878\"\n\nexport default script","import {computed} from 'vue'\nimport {useStore} from 'vuex'\nimport {currency} from '../utils/currency'\n\nexport function useCartPage() {\n  const store = useStore()\n\n  const products = computed(() => store.getters['product/products'])\n\n  const title = id => products.value.find(p => p.id === id)?.title\n  const price = id => currency(products.value.find(p => p.id === id)?.price)\n  const count = id => products.value.find(p => p.id === id)?.count\n\n  const cart = store.getters['cart/cart']\n\n  const total = computed(() => {\n    return Object.keys(cart).reduce((acc, id) => {\n      return acc += products.value.find(p => p.id === id)?.price * cart[id]\n    }, 0)\n  })\n\n  const isEmpty = computed(() => Object.keys(cart).length === 0)\n\n  return {isEmpty, title, price, count, total, cart}\n}","export function pay({amount, description, accountId, data = {} }) {\n  const widget = new cp.CloudPayments()\n\n  return new Promise((resolve, reject) => {\n    widget.pay('charge',\n      {\n        publicId: 'test_api_00000000000000000000001',\n        currency: 'RUB',\n        skin: 'mini',\n        description,\n        amount,\n        accountId,\n        data\n      },\n      {\n        onSuccess(options) {\n          resolve(options)\n        },\n        onFail(reason, options) {\n          reject(reason)\n        }\n      }\n    )\n  })\n}","import { render } from \"./Cart.vue?vue&type=template&id=37b6a91c&scoped=true\"\nimport script from \"./Cart.vue?vue&type=script&lang=js\"\nexport * from \"./Cart.vue?vue&type=script&lang=js\"\nscript.render = render\nscript.__scopeId = \"data-v-37b6a91c\"\n\nexport default script","import {computed} from 'vue'\nimport {useStore} from 'vuex'\n\nexport function useProductCart(defaultId) {\n  const store = useStore()\n\n  const count = computed(() => store.getters['cart/cart'][defaultId] ?? 0)\n\n  const add = (prodId) => store.commit('cart/add', prodId)\n\n  const sub = (prodId) => store.commit('cart/remove', prodId)\n\n  return {\n    count,\n    add,\n    sub\n  }\n}"],"sourceRoot":""}